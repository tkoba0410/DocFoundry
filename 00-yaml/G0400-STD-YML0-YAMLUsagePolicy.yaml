doc_id: G040-YAML-Usage-Policy
title: YAML活用方針書（汎用開発標準）
version: "1.0.0"
date: "2025-11-04"
lifecycle: active
category: development-standard
authoring:
  maintainer: Documentation Team
  approved_by: Architecture Board
  created_at: "2025-11-04T00:00:00+09:00"
  updated_at: "2025-11-04T00:00:00+09:00"

purpose: >
  本方針は、プロジェクト全体における仕様・設計・生成・検証の基盤形式として
  YAMLを原則とすることを目的とする。
  これにより、開発資産の一貫性・再現性・自動化を確立し、
  仕様の統一的な運用を支える。

principles:
  - name: YAML原則主義
    description: 開発に関わるすべての仕様定義・構成情報はYAML形式で記述することを原則とする。
  - name: 唯一の正（Single Source of Truth）
    description: ".yaml を唯一の仕様ソースとし、すべての生成・参照の基点とする。"
  - name: 自動生成主義
    description: コード・テスト・ドキュメントはYAMLから自動生成し、手作業による差異を排除する。
  - name: 人機両可読性
    description: YAMLは人間と機械の双方に理解可能な構造を保つ。
  - name: 追跡可能性（Traceability）
    description: "`doc_id`, `goal_id`, `req_id` などの識別子を生成物に埋め込み、仕様との対応を明示する。"
  - name: 変更一元管理
    description: すべての変更はYAMLを起点とし、生成物の直接編集を禁止する。

operation:
  flow: "可読文書 → YAML仕様（唯一の正） → 成果物（コード／テスト／ドキュメント） → CI検証"
  responsibilities:
    - YAMLが唯一の編集対象である。
    - 生成物の直接編集は禁止され、CIで検出・エラーとする。
    - 可読文書からのYAML化は初期導入時に限定する。
    - 以降の更新は「YAML→自動生成」の一方向フローを厳守する。
  introduction_rules:
    - YAML化は初期導入時のみ許可。
    - 変換担当はCODEOWNERが指名。
    - YAMLはCI検証必須。
    - 原文はアーカイブ保存のみ可。
  paired_management:
    - YAML仕様と可読仕様書（Markdown）はセットで管理。
    - YAML更新時に仕様書を自動生成または同期。
    - CIでYAMLと仕様書の不整合を検出。
    - 仕様書は参照用であり直接編集禁止。
    - `doc_id`により両者をトレース。

syntax_rules:
  encoding: "UTF-8 (no BOM)"
  indent: 2
  newline: LF
  boolean_values: [true, false]
  date_format: ISO8601
  comment_style: "# "
  file_naming: lower-kebab-case.yaml
  prohibited: [tab, duplicate_keys, ambiguous_boolean_values]

structure_and_layout:
  base_directory: "/specs/"
  subdirectories:
    domain: "各エンティティ仕様（YAML本体）"
    schema: "検証用スキーマ（JSON Schema互換）"
    meta: "AI補助メタ情報"
  rules:
    - "1仕様 = 1ファイル" 原則
    - schema/metaは同名ペアで管理
    - 拡張子は `.yaml` に統一

quality_and_ci:
  checks:
    - name: 構文検証
      method: yamllint / jsonschema
      condition: エラーがないこと
    - name: 意味検証
      method: validate-yaml.py
      condition: YAML間の参照整合性
    - name: 差分検証
      method: git diff --exit-code
      condition: 生成物の手動変更なし
    - name: トレーサビリティ検証
      method: doc_id整合チェック
      condition: 仕様と生成物が一致
    - name: 自動生成ヘッダ検証
      method: AUTO-GENERATEDヘッダ確認
      condition: 改変時にFail
    - name: Prose編集検知
      method: CIチェック
      condition: Markdownの直編集なし

extensions:
  - typed_yaml: true
  - schema_with_types: true
  - dsl_support: true
  - ai_meta_enabled: true
  - conversion_targets: [json, graph, model]

schema_evolution:
  breaking_changes: "schema_versionをメジャーアップ"
  deprecation: "/deprecated/に旧版を保存"
  validation_required: true

organization:
  responsibility: CODEOWNERSでドメイン所有者を明示
  update_unit: "1仕様 = 1PR"
  approval: "CI成功＋レビュー承認で確定"
  versioning: Semantic Versioning
  lifecycle: managed

education_and_review:
  yaml_maintainer: 各ドメインごとに配置
  training_cycle: 半期ごとに標準更新と教育実施

synchronization_rules:
  - 各YAML仕様は対応仕様書(Markdown)を必ず持つ。
  - 両者は同一doc_idで結合。
  - CIでYAML→仕様書を自動生成し差分検証。
  - 仕様書の手動変更は禁止。
  - 内容の正は常にYAMLに従う。

one_way_principle:
  description: >
    本方針における情報流通は「可読文書 → YAML → 成果物」の片方向フローに限定する。
    一度YAMLとして定義された仕様を、可読文書や他形式から再変換して上書きする行為を禁止する。
    YAML以外の形式から仕様を反映する場合は、新規doc_idを発行し、再審査を経る。

appendix:
  ai_meta_example:
    purpose: DTO自動生成のための構造定義
    generator: ChatGPT / LangChain
    model: gpt-5
    version: "2025.11.0"
    context:
      input_format: YAML
      output_format: "C# DTO"
    authoring:
      maintainer: Documentation Team
      created_at: "2025-11-04T00:00:00+09:00"
