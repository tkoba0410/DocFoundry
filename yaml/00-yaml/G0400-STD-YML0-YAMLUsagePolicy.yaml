---
schema: "https://schema.org/CreativeWork"
doc_id: "G0400-STD-YML0"
title: "YAML Usage Policy (General Edition, AI-aligned)"
version: "v1.0.0"
date: "2025-11-04"
status: "Approved"
owner: "Documentation Team"
reviewers: ["Project Maintainer"]
confidentiality: "Public"
scope: "Generic"
lifecycle: "Canonical"
description: "Policy that defines YAML as the single source for specification, generation, and verification with AI alignment."
related_docs: ["G0100-STD-DOC0","G0101-STD-DOC1"]
x-schema: "/schemas/dcmm.doc.schema.json"
---

policy:
  purpose: "YAMLを仕様・設計・生成・検証の基盤形式とし、一貫性・再現性・自動化を確立する。"

  principles:
    - code: "YAMLism"
      name: "YAML原則主義"
      rule: "開発に関わる全ての仕様定義・構成情報は YAML 形式を原則とする。"
    - code: "SSOT"
      name: "唯一の正（Single Source of Truth）"
      rule: "`.yaml` を唯一の仕様ソースとし、生成・参照の基点とする。"
    - code: "AutoGen"
      name: "自動生成主義"
      rule: "コード・テスト・ドキュメントは YAML から自動生成し、手作業差異を排除する。"
    - code: "BiReadable"
      name: "人機両可読性"
      rule: "YAMLは人間と機械の双方に理解可能な構造を保つ。"
    - code: "Traceability"
      name: "追跡可能性"
      rule: "`doc_id`, `goal_id`, `req_id` 等の識別子を生成物へ埋め込み対応を明示する。"
    - code: "ChangeOrigin"
      name: "変更一元管理"
      rule: "すべての変更は YAML 起点。生成物の直接編集は禁止。"
    - code: "AI-Consistency"
      name: "AI補助一貫性原則"
      rule: "AIによる仕様生成・補完も YAML 形式に統一し、スキーマ検証で再現性を保証する。"

  operations:
    standard_flow:
      diagram: "自然文（AI/人間） → 構造抽出 → YAML（唯一の正） → 生成（コード/テスト/ドキュメント） → CI検証"
      steps:
        - "自然文（AI生成・人間発想）"
        - "構造抽出"
        - "YAML仕様（唯一の正）"
        - "コード生成／テスト生成／ドキュメント生成"
        - "CIによる自動検証・整合チェック"
    editing_responsibility:
      - "編集対象は全ての YAML（唯一の正）。"
      - "生成物の直接編集は禁止（CIで検出・エラー）。"
      - "人間可読文書からのYAML化は初期導入時のみ。"
      - "以降は YAML → 自動生成 の一方向フローを厳守。"
    yaml_onboarding_criteria:
      - "初期導入時のみ Word/Markdown を YAML 化。"
      - "変換は各ドメイン責任者（CODEOWNER）が指名。"
      - "変換後のYAMLはCI検証必須。"
      - "原文は参考アーカイブとして保存し以後の更新を禁止。"
    pairing_policy:
      - "YAML仕様と人間可読仕様書（Markdown）をセットで管理。"
      - "YAML更新時、仕様書は自動生成またはテンプレート同期で更新。"
      - "不整合はCIで検出・整合性エラー。"
      - "仕様書は参照用で直接編集禁止。"
      - "`doc_id` により双方向トレース可能とする。"

  relation_to_human_docs:
    rule: "既存の要件定義書や設計書は YAML 形式へ移行する。"

  syntax_rules:
    encoding: "UTF-8 (BOMなし)"
    indent: "2 spaces"
    newline: "LF"
    booleans: ["true","false"]
    date_example: ""2025-11-04T00:00:00+09:00""
    comments: "# で開始し構造保持を妨げない"
    filename: "lower-kebab-case.yaml"
    prohibited: ["Tab","Duplicate Keys","Ambiguous Booleans (yes/no/on/off)"]

  structure_and_layout:
    directories:
      - path: "/specs/domain"
        description: "各エンティティ仕様（1仕様=1ファイル）"
      - path: "/specs/schema"
        description: "JSON Schema（entity-name.schema.yaml）"
      - path: "/specs/meta"
        description: "AI補助メタ（ai-meta.yaml）"
    rules:
      - "schema / meta は対応する仕様と同名。"
      - "拡張子は .yaml に統一。"

  quality_and_ci:
    checks:
      - name: "構文検証"
        method: ["yamllint","jsonschema"]
        pass: "エラーがないこと"
      - name: "意味検証"
        method: ["validate-yaml.py"]
        pass: "YAML間の参照整合性が取れていること"
      - name: "差分検証"
        method: ["git diff --exit-code"]
        pass: "生成物に手動変更がないこと"
      - name: "トレーサビリティ"
        method: ["doc_id/goal_id/req_id 照合"]
        pass: "全生成物に反映されていること"
      - name: "自動生成ヘッダ検証"
        method: ["AUTO-GENERATED ヘッダ検査"]
        pass: "改変時にFail"
      - name: "Prose編集検知"
        method: ["CIチェック"]
        pass: "Markdown等の直編集がないこと"
      - name: "AI出力整合性"
        method: ["ai_meta スキーマ整合"]
        pass: "モデル情報・生成日時・プロンプト履歴の保持"
      - name: "AI再現性検証"
        method: ["AI再実行スクリプト"]
        pass: "同一入力で同一YAMLが再生成されること"

  extensions_and_applications:
    recommendations:
      - "型付きYAMLやSchema付きYAMLを推奨。"
      - "DSLの基礎構文としてYAMLを活用可。"
      - "ai_meta等の補助情報をYAML内に保持可能。"
      - "YAML → JSON/Graph/Model 変換で自動生成を高度化。"
    schema_evolution:
      breaking_change: "schema_version のメジャーアップで表現。"
      backward_compatibility: "困難な場合は /deprecated/ に保存。"
      regeneration_rule: "Schema変更時はコード/テストを再生成・再検証する。"

  governance:
    responsibilities:
      - key: "責任範囲"
        rule: "各ドメイン所有者（CODEOWNERSで明示）。"
      - key: "更新単位"
        rule: "1仕様 = 1PR 原則。"
      - key: "承認手続"
        rule: "CI成功＋レビュー承認で確定。"
      - key: "廃止管理"
        rule: "lifecycle: deprecated を明記。"
      - key: "バージョン管理"
        rule: "Semantic Versioning（例："v1.0.0"）準拠。"
    education_and_review:
      - "各ドメインに YAMLメンテナ を置きレビューを担当。"
      - "教育責任者は全体標準維持と新人教育を担う。"
      - "半期ごとに標準更新と教育セッションを実施。"
      - "YAMLメンテナはAI出力の品質検証・スキーマ準拠確認を行う。"
    sync_rules:
      - "各YAML仕様は対応する仕様書（Markdown）を必ず持つ。"
      - "両者は同一 doc_id で対応付け。"
      - "CIでYAML→仕様書自動生成し差分検証。"
      - "仕様書のみの手動変更は禁止。"
      - "仕様書はレビュー・共有・可読性確保を目的とし、正はYAMLに従う。"
    one_way_policy:
      - "可読文書 → YAML → 成果物 の片方向フローに限定。"
      - "YAML定義済を他形式から再変換で上書きする行為を禁止。"
      - "他形式から反映する場合は新規 doc_id を発行し再審査を経る。"

  ai_alignment:
    assumptions:
      - "AI（LLM/自動生成ツール）による仕様生成・補助作業を前提。"
      - "AI出力は YAML スキーマに基づく構造的生成を原則。"
      - "自然言語仕様のみは暫定扱い。"
      - "AI生成YAMLは必ずスキーマ検証を通す。"
      - "生成条件・文脈は ai_meta に保持し再現性・説明責任を担保。"
      - "創造は自然文で、確定はYAMLで。"

appendix:
  ai_meta_sample:
    ai_meta:
      purpose: "DTO自動生成のための構造定義"
      generator: "ChatGPT / LangChain"
      model: "gpt-5"
      version: "2025.11.0"
      context:
        input_format: "YAML"
        output_format: "C# DTO"
      authoring:
        maintainer: "Documentation Team"
        created_at: "2025-11-04T00:00:00+09:00"
