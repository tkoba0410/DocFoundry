division_instruction:
  schema_version: "v1.0.1"
  source_document:
    identifier: "G0130-STD-DOC3-DivisionGuideline"
    name: "分冊（Volume）方式・汎用ファイル名規則（末尾番号方式）"
    version: "v1.0.0"

  purpose: "大規模 Markdown 文書を Volume（分冊）方式で分割するための手順と規則を定義する。"

  #--------------------------------------------
  # 1. 分割判定
  #--------------------------------------------
  decision_rules:
    applicable_content_types:
      - "markdown"
      - "code"
    count_unit: "chapter"                      # 章単位で行数をカウント
    line_limits:
      recommended: 200                         # SHOULD
      max: 300                                 # MUST
    split_policy:
      must_not_split_inside_chapter: true      # 章途中での分割禁止
      start_with_vol01: true                   # 分冊開始時は Vol01 から
      vol00_required_when_volume_used: true    # Volume 方式を採用する場合は Vol00 を作成（Index）
      allow_single_file_without_volume: true   # 行数以内なら分割しない（MUST）
    code_split_policy:
      unit: "class_or_function"                # コードの場合はクラス／関数単位
      must_not_split_inside_unit: true

  #--------------------------------------------
  # 2. ファイル生成規則
  #--------------------------------------------
  file_generation:
    numbering:
      format: "2_digits"                       # 2 桁整数 00,01,02...
      start: 0
      suffix_position: "after_title"           # タイトルの末尾に付与
      vol00_role: "index"
    volumes:
      vol00:
        must_create_physical_file: true
        must_have_body: false
        must_have_h1_title: true
        must_have_index: true
        must_include:
          - "front_matter"
          - "toc_3layers"       # Vol → 章 → 節
          - "reference_documents"
          - "revision_history"
        must_not_include:
          - "main_content"
      volNN:
        must_create_physical_file: true
        must_include:
          - "front_matter"
          - "h1_title"
          - "chapter_list"
          - "body"
        must_not_include:
          - "reference_documents"
          - "revision_history"
    non_volume_files:
      description: "分割不要文書（単一ファイル完結）の扱い"
      conditions:
        - "行数が line_limits.max 以内で収まる"
      behavior:
        has_volume_suffix: false               # Vol番号を付けない（MUST）
        requires_vol00: false                  # 00番ファイルは不要（MUST）
        may_migrate_to_volume_later: true      # 将来分冊が必要になった場合のみ Vol 方式へ移行（SHOULD）
    file_structure:
      prefix:
        options: ["G", "P"]
        description: "G=汎用、P=プロジェクト"
      filename_pattern: "{Prefix}{4digits}-{Category3}-{Doc4}-{Title}-{Vol2}.md"
      title_rule:
        ascii_only: true
        allowed_chars: "A-Z, a-z, 0-9, hyphen"
        style: "UpperCamelCase recommended"

  #--------------------------------------------
  # 3. Front Matter（CreativeWork 9キー）
  #--------------------------------------------
  front_matter_rules:
    must_include_all_volumes: true
    keys:
      - schema
      - "@type"
      - identifier
      - name
      - description
      - version
      - datePublished
      - inLanguage
      - creator
    identifier:
      must_match_filename: true
    per_volume_uniqueness:
      identifier: true
      name: true
      description: true
    name_format:
      jp_title_with_volume_number: true
      structure: "{日本語正式タイトル} 第N巻（第X,Y,Z章 または 附録A）"
      chapter_list_style: "列挙形式（第1,2,3章…）"
      appendix_style: "附録A, 附録B..."
      must_not_use_short_codes: true     # c1–c3 など禁止

  #--------------------------------------------
  # 4. 分割手順
  #--------------------------------------------
  workflow:
    - step: "文書を章単位で分割し、各章の行数を計測する"
    - step: "Vol01 に章を順次追加する（200行を目安）"
    - step: "200行を超える場合は、章単位で Vol02 以降へ送る（章途中の分割は禁止）"
    - step: "必要に応じて Vol03, Vol04… を生成する"
    - step: "Volume 方式を採用する場合、Vol00（総合編／Index）を作成する"
    - step: "Vol00 に Vol→章→節の3階層目次を作成する"
    - step: "各 Vol ファイルに CreativeWork 9キーの Front Matter を設定する"
    - step: "identifier/name/description を巻単位で固有の値に設定する"
    - step: "Vol01 以降には参照文書・改訂履歴を含めない"

  #--------------------------------------------
  # 5. チェックリスト（CI/Lint 用）
  #--------------------------------------------
  validation_rules:
    - name: "行数超過"
      must: "各 Vol の本文が 300 行を超えないこと"
    - name: "章境界分割"
      must: "章途中での分割が行われていないこと"
    - name: "コード境界分割"
      must: "コードの場合、クラス／関数途中で分割されていないこと"
    - name: "Front Matter 9キー"
      must: "すべての Vol ファイルに CreativeWork 9キーが存在すること"
    - name: "identifier 一致"
      must: "identifier がファイル名と完全一致していること"
    - name: "Vol00 目次構造"
      must: "Vol00 に Vol→章→節の3階層目次が存在すること"
    - name: "Vol00 目次整合性"
      must: "Vol00 の目次と Vol01 以降の実際の章構成が一致していること"
    - name: "Vol 内参照文書・改訂履歴なし"
      must_not: "Vol01 以降に参照文書・改訂履歴が含まれていないこと"
    - name: "Vol00 本文なし"
      must_not: "Vol00 に本文（本編コンテンツ）が存在しないこと"
    - name: "ファイル名構造"
      must: "プレフィックス・カテゴリ3・文書4・タイトル・Vol番号が命名規則に従っていること"
    - name: "ファイル名文字種"
      must: "ファイル名が ASCII 英数字＋ハイフンのみで構成されていること"
    - name: "name 日本語"
      must: "Front Matter の name が完全日本語・単一言語（inLanguage: ["ja"]）であること"

  #--------------------------------------------
  # 6. 例示
  #--------------------------------------------
  examples:
    split_files:
      description: "G0100-STD-DOC0-FormatPolicy を分冊した場合の例"
      files:
        - "G0100-STD-DOC0-FormatPolicy-00.md"
        - "G0100-STD-DOC0-FormatPolicy-01.md"
        - "G0100-STD-DOC0-FormatPolicy-02.md"
        - "G0100-STD-DOC0-FormatPolicy-03.md"
    non_split_file:
      description: "分割不要文書の例（Vol番号なし・単一ファイル完結）"
      file: "G0300-ARC-DES0-ApiDesign.md"

  #--------------------------------------------
  # 7. メリット（末尾番号方式採用理由）
  #--------------------------------------------
  rationale:
    - "非分割文書との整合性が高く、Volume 方式と単一ファイル方式を同一スキームで運用できる"
    - "Vol 番号がタイトル末尾に付与されるため、ソート順が安定し揺らぎが無い"
    - "Volume 構造を後付けで追加しやすく、既存ファイルの拡張が容易"
    - "シリーズとしての一体感が高く、読み手にとって直感的なタイトル体系となる"
